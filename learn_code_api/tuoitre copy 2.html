<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D·ª± b√°o th·ªùi ti·∫øt Vi·ªát Nam</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.95;
        }
        
        .controls {
            padding: 25px;
            background-color: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .city-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1rem;
        }
        
        select {
            padding: 12px 20px;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 1rem;
            background-color: white;
            flex-grow: 1;
            min-width: 250px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover {
            border-color: #764ba2;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        select:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
        }
        
        .weather-display {
            padding: 30px;
            min-height: 450px;
        }
        
        .current-weather {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        
        .city-name {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .temperature {
            font-size: 5rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .weather-description {
            font-size: 1.8rem;
            margin-bottom: 20px;
            opacity: 0.95;
        }
        
        .weather-icon {
            font-size: 6rem;
            margin: 20px 0;
        }
        
        .weather-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .detail-item {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .detail-label {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .loading {
            text-align: center;
            padding: 60px 20px;
            font-size: 1.3rem;
            color: #7f8c8d;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error {
            text-align: center;
            padding: 40px 20px;
            color: #e74c3c;
            font-size: 1.2rem;
            background-color: #fee;
            border-radius: 10px;
            border: 2px solid #fcc;
        }
        
        .forecast-section {
            margin-top: 30px;
        }
        
        .forecast-title {
            font-size: 1.5rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }
        
        .forecast-days {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .forecast-day {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .forecast-day:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        
        .forecast-day-name {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .forecast-temp {
            font-size: 1.8rem;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .forecast-desc {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background-color: #f8f9fa;
            color: #7f8c8d;
            font-size: 0.95rem;
            border-top: 2px solid #e9ecef;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .temperature {
                font-size: 3.5rem;
            }
            
            .city-name {
                font-size: 2rem;
            }
            
            .weather-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå§Ô∏è D·ª± B√°o Th·ªùi Ti·∫øt Vi·ªát Nam</h1>
            <div class="subtitle">C·∫≠p nh·∫≠t th√¥ng tin th·ªùi ti·∫øt ch√≠nh x√°c cho 63 t·ªânh th√†nh</div>
        </header>
        
        <div class="controls">
            <div class="city-selector">
                <label for="provinces">üìç Ch·ªçn t·ªânh/th√†nh ph·ªë:</label>
                <select id="provinces" onchange="show_detail_weather_forecast(this.value)">
                    <option value="">-- Ch·ªçn ƒë·ªãa ƒëi·ªÉm --</option>
                </select>
            </div>
        </div>
        
        <div class="weather-display" id="weather-display">
            <div class="loading">
                Vui l√≤ng ch·ªçn m·ªôt t·ªânh/th√†nh ph·ªë ƒë·ªÉ xem d·ª± b√°o th·ªùi ti·∫øt
            </div>
        </div>
        
        <footer>
            <p>üì° D·ªØ li·ªáu th·ªùi ti·∫øt ƒë∆∞·ª£c cung c·∫•p b·ªüi Tu·ªïi Tr·∫ª Online</p>
            <p style="margin-top: 5px; font-size: 0.85rem;">API: https://utils3.cnnd.vn/ajax/weatherinfo/</p>
        </footer>
    </div>

    <script>
        var ids = ['2347719', '20070078', '20070086', '2347731', '2347730', '20070081', '20070087', '20070084', '20070088', '2347703', '2347704', '20070082', '2347732', '28301718', '20070085', '1252375', '2347720', '28301719', '2347721', '2347722', '2347733', '2347727', '2347728', '2347734', '2347741', '2347736', '2347737', '20070079', '20070080', '2347707', '28301720', '2347738', '2347723', '20070076', '2347708', '2347710', '2347740', '2347709', '2347718', '20070089', '2347742', '2347743', '2347744', '20070091', '2347745', '2347746', '2347711', '20070077', '2347712', '2347747', '2347748', '2347713', '2347715', '2347716', '20070083', '2347749', '2347717', '2347750', '2347751', '2347714', '2347752', '20070090', '2347729', '2347753'];
        var names = ['An Giang', 'B√¨nh D∆∞∆°ng', 'B√¨nh Ph∆∞·ªõc', 'B√¨nh Thu·∫≠n', 'B√¨nh ƒê·ªãnh', 'B·∫°c Li√™u', 'B·∫Øc Giang', 'B·∫Øc K·∫°n', 'B·∫Øc Ninh', 'B·∫øn Tre', 'Cao B·∫±ng', 'C√† Mau', 'C·∫ßn Th∆°', 'ƒêi·ªán Bi√™n', 'ƒê√† N·∫µng', 'ƒê√† L·∫°t', 'ƒê·∫Øk L·∫Øk', 'ƒê·∫Øk N√¥ng', 'ƒê·ªìng Nai', 'ƒê·ªìng Th√°p', 'Gia Lai', 'H√† N·ªôi', 'TP. H·ªì Ch√≠ Minh', 'H√† Giang', 'H√† Nam', 'H√† Tƒ©nh', 'H√≤a B√¨nh', 'H∆∞ng Y√™n', 'H·∫£i D∆∞∆°ng', 'H·∫£i Ph√≤ng', 'H·∫≠u Giang', 'Kh√°nh H√≤a', 'Ki√™n Giang', 'Kon Tum', 'Lai Ch√¢u', 'Long An', 'L√†o Cai', 'L√¢m ƒê·ªìng', 'L·∫°ng S∆°n', 'Nam ƒê·ªãnh', 'Ngh·ªá An', 'Ninh B√¨nh', 'Ninh Thu·∫≠n', 'Ph√∫ Th·ªç', 'Ph√∫ Y√™n', 'Qu·∫£ng B√¨nh', 'Qu·∫£ng Nam', 'Qu·∫£ng Ng√£i', 'Qu·∫£ng Ninh', 'Qu·∫£ng Tr·ªã', 'S√≥c TrƒÉng', 'S∆°n La', 'Thanh H√≥a', 'Th√°i B√¨nh', 'Th√°i Nguy√™n', 'Th·ª´a Thi√™n Hu·∫ø', 'Ti·ªÅn Giang', 'Tr√† Vinh', 'Tuy√™n Quang', 'T√¢y Ninh', 'Vƒ©nh Long', 'Vƒ©nh Ph√∫c', 'V≈©ng T√†u', 'Y√™n B√°i'];

        function getWeatherIcon(desc) {
            if (!desc) return 'üå§Ô∏è';
            desc = desc.toLowerCase();
            if (desc.includes('m∆∞a') || desc.includes('rain')) return 'üåßÔ∏è';
            if (desc.includes('n·∫Øng') || desc.includes('sunny') || desc.includes('clear')) return '‚òÄÔ∏è';
            if (desc.includes('m√¢y') || desc.includes('cloud')) return '‚òÅÔ∏è';
            if (desc.includes('s∆∞∆°ng m√π') || desc.includes('fog')) return 'üå´Ô∏è';
            if (desc.includes('b√£o') || desc.includes('storm')) return '‚õàÔ∏è';
            return 'üå§Ô∏è';
        }

        function load_provinces() {
            var provinces = document.getElementById("provinces");
            for (var i = 0; i < ids.length; i++) {
                var city_id = ids[i];
                var city_name = names[i];
                var opt = document.createElement("option");
                opt.value = city_id;
                opt.innerText = city_name;
                provinces.appendChild(opt);
            }
        }

        function show_detail_weather_forecast(value) {
            if (!value) return;
            
            var weatherDisplay = document.getElementById("weather-display");
            weatherDisplay.innerHTML = '<div class="loading"><div class="loading-spinner"></div><br>ƒêang t·∫£i d·ªØ li·ªáu th·ªùi ti·∫øt...</div>';
            
            var proxy = "https://api.allorigins.win/raw?url=";
            var api = "https://utils3.cnnd.vn/ajax/weatherinfo/" + value + ".htm";
            var api_proxy = proxy + encodeURIComponent(api);
            
            var xhr = new XMLHttpRequest();
            xhr.open("GET", api_proxy, true);
            xhr.timeout = 15000;
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        var string_json = xhr.responseText;
                        var object_json = JSON.parse(string_json);
                        displayWeatherData(object_json, value);
                    } catch (e) {
                        console.error("L·ªói ph√¢n t√≠ch JSON:", e);
                        console.log("D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:", xhr.responseText);
                        weatherDisplay.innerHTML = '<div class="error">‚ùå L·ªói khi ph√¢n t√≠ch d·ªØ li·ªáu th·ªùi ti·∫øt<br><small>Vui l√≤ng th·ª≠ l·∫°i sau</small></div>';
                    }
                } else {
                    weatherDisplay.innerHTML = '<div class="error">‚ùå Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu (Status: ' + xhr.status + ')<br><small>Vui l√≤ng th·ª≠ l·∫°i sau</small></div>';
                }
            };
            
            xhr.onerror = function() {
                weatherDisplay.innerHTML = '<div class="error">‚ùå L·ªói k·∫øt n·ªëi<br><small>Vui l√≤ng ki·ªÉm tra internet v√† th·ª≠ l·∫°i</small></div>';
            };
            
            xhr.ontimeout = function() {
                weatherDisplay.innerHTML = '<div class="error">‚è±Ô∏è K·∫øt n·ªëi qu√° th·ªùi gian ch·ªù<br><small>Vui l√≤ng th·ª≠ l·∫°i</small></div>';
            };
            
            xhr.send();
        }

        function displayWeatherData(data, cityId) {
            var cityIndex = ids.indexOf(cityId);
            var cityName = cityIndex !== -1 ? names[cityIndex] : "Kh√¥ng x√°c ƒë·ªãnh";
            var weatherDisplay = document.getElementById("weather-display");
            
            console.log("D·ªØ li·ªáu API:", data);
            
            // X·ª≠ l√Ω nhi·ªÅu c·∫•u tr√∫c d·ªØ li·ªáu c√≥ th·ªÉ c√≥
            var temp = "N/A";
            var desc = "Kh√¥ng c√≥ d·ªØ li·ªáu";
            var humidity = "N/A";
            var wind = "N/A";
            var pressure = "N/A";
            var forecastData = [];
            
            // C·∫•u tr√∫c 1: D·ªØ li·ªáu t·ª´ OpenWeatherMap
            if (data.main && data.weather && data.weather.length > 0) {
                temp = Math.round(data.main.temp);
                desc = data.weather[0].description;
                humidity = data.main.humidity;
                wind = data.wind ? data.wind.speed : "N/A";
                pressure = data.main.pressure;
            }
            // C·∫•u tr√∫c 2: D·ªØ li·ªáu c√≥ thu·ªôc t√≠nh current
            else if (data.current) {
                temp = Math.round(data.current.temp || data.current.temperature || 0);
                desc = data.current.description || data.current.desc || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                humidity = data.current.humidity || "N/A";
                wind = data.current.wind_speed || data.current.wind || "N/A";
                pressure = data.current.pressure || "N/A";
            }
            // C·∫•u tr√∫c 3: D·ªØ li·ªáu tr·ª±c ti·∫øp
            else if (data.temp || data.temperature) {
                temp = Math.round(data.temp || data.temperature || 0);
                desc = data.description || data.desc || "Kh√¥ng c√≥ d·ªØ li·ªáu";
                humidity = data.humidity || "N/A";
                wind = data.wind_speed || data.wind || "N/A";
                pressure = data.pressure || "N/A";
            }
            // C·∫•u tr√∫c 4: C√≥ m·∫£ng list ho·∫∑c daily
            else if (data.list && data.list.length > 0) {
                var current = data.list[0];
                temp = Math.round(current.main ? current.main.temp : current.temp);
                desc = current.weather ? current.weather[0].description : (current.description || "Kh√¥ng c√≥ d·ªØ li·ªáu");
                humidity = current.main ? current.main.humidity : (current.humidity || "N/A");
                wind = current.wind ? current.wind.speed : (current.wind_speed || "N/A");
                pressure = current.main ? current.main.pressure : (current.pressure || "N/A");
                
                // L·∫•y d·ª± b√°o c√°c ng√†y
                for (var i = 1; i < Math.min(data.list.length, 6); i++) {
                    forecastData.push(data.list[i]);
                }
            }
            else if (data.daily && data.daily.length > 0) {
                var current = data.daily[0];
                temp = Math.round(current.temp ? (current.temp.day || current.temp) : 0);
                desc = current.weather ? current.weather[0].description : (current.description || "Kh√¥ng c√≥ d·ªØ li·ªáu");
                humidity = current.humidity || "N/A";
                wind = current.wind_speed || "N/A";
                pressure = current.pressure || "N/A";
                
                for (var i = 1; i < Math.min(data.daily.length, 6); i++) {
                    forecastData.push(data.daily[i]);
                }
            }
            
            var icon = getWeatherIcon(desc);
            
            var currentHTML = `
                <div class="current-weather">
                    <div class="city-name">${cityName}</div>
                    <div class="weather-icon">${icon}</div>
                    <div class="temperature">${temp}¬∞C</div>
                    <div class="weather-description">${desc}</div>
                    <div class="weather-details">
                        <div class="detail-item">
                            <div class="detail-label">üíß ƒê·ªô ·∫©m</div>
                            <div class="detail-value">${humidity}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üí® Gi√≥</div>
                            <div class="detail-value">${wind} m/s</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">üå°Ô∏è √Åp su·∫•t</div>
                            <div class="detail-value">${pressure} hPa</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Hi·ªÉn th·ªã d·ª± b√°o n·∫øu c√≥
            if (forecastData.length > 0) {
                currentHTML += `
                    <div class="forecast-section">
                        <div class="forecast-title">üìÖ D·ª± b√°o c√°c ng√†y t·ªõi</div>
                        <div class="forecast-days">
                `;
                
                var days = ['Ch·ªß Nh·∫≠t', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7'];
                
                forecastData.forEach(function(day, index) {
                    var dayTemp = "N/A";
                    var dayDesc = "";
                    
                    if (day.main && day.main.temp) {
                        dayTemp = Math.round(day.main.temp);
                    } else if (day.temp) {
                        dayTemp = Math.round(day.temp.day || day.temp);
                    }
                    
                    if (day.weather && day.weather[0]) {
                        dayDesc = day.weather[0].description;
                    } else if (day.description) {
                        dayDesc = day.description;
                    }
                    
                    var today = new Date();
                    var futureDay = new Date(today);
                    futureDay.setDate(today.getDate() + index + 1);
                    var dayName = days[futureDay.getDay()];
                    
                    var dayIcon = getWeatherIcon(dayDesc);
                    
                    currentHTML += `
                        <div class="forecast-day">
                            <div class="forecast-day-name">${dayName}</div>
                            <div style="font-size: 2.5rem; margin: 10px 0;">${dayIcon}</div>
                            <div class="forecast-temp">${dayTemp}¬∞C</div>
                            <div class="forecast-desc">${dayDesc}</div>
                        </div>
                    `;
                });
                
                currentHTML += `
                        </div>
                    </div>
                `;
            }
            
            weatherDisplay.innerHTML = currentHTML;
        }

        window.onload = function() {
            load_provinces();
        };
    </script>
</body>
</html>